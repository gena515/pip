Improve performance of resolution of large dependency trees, with more caching.
